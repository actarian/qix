/**
 * @license qix-js v0.0.1
 * (c) 2020 Renaud Ninauve
 * License:
 */
!function(){"use strict";function t(t,i){return t(i={exports:{}},i.exports),i.exports}var i=t((function(t){var i=function(t){var i=Object.prototype,e=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function h(t,i,e,r){var s=i&&i.prototype instanceof l?i:l,n=Object.create(s.prototype),o=new b(r||[]);return n._invoke=function(t,i,e){var r="suspendedStart";return function(s,n){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===s)throw n;return T()}for(e.method=s,e.arg=n;;){var o=e.delegate;if(o){var h=x(o,e);if(h){if(h===c)continue;return h}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===r)throw r="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r="executing";var l=a(t,i,e);if("normal"===l.type){if(r=e.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:e.done}}"throw"===l.type&&(r="completed",e.method="throw",e.arg=l.arg)}}}(t,e,o),n}function a(t,i,e){try{return{type:"normal",arg:t.call(i,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var c={};function l(){}function u(){}function f(){}var d={};d[s]=function(){return this};var p=Object.getPrototypeOf,g=p&&p(p(L([])));g&&g!==i&&e.call(g,s)&&(d=g);var y=f.prototype=l.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(i){t[i]=function(t){return this._invoke(i,t)}}))}function _(t,i){var r;this._invoke=function(s,n){function o(){return new i((function(r,o){!function r(s,n,o,h){var c=a(t[s],t,n);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&e.call(u,"__await")?i.resolve(u.__await).then((function(t){r("next",t,o,h)}),(function(t){r("throw",t,o,h)})):i.resolve(u).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,h)}))}h(c.arg)}(s,n,r,o)}))}return r=r?r.then(o,o):o()}}function x(t,i){var e=t.iterator[i.method];if(void 0===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=void 0,x(t,i),"throw"===i.method))return c;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=a(e,t.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,c;var s=r.arg;return s?s.done?(i[t.resultName]=s.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=void 0),i.delegate=null,c):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,c)}function w(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function m(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function b(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function L(t){if(t){var i=t[s];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function i(){for(;++r<t.length;)if(e.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=void 0,i.done=!0,i};return n.next=n}}return{next:T}}function T(){return{value:void 0,done:!0}}return u.prototype=y.constructor=f,f.constructor=u,f[o]=u.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===u||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},v(_.prototype),_.prototype[n]=function(){return this},t.AsyncIterator=_,t.async=function(i,e,r,s,n){void 0===n&&(n=Promise);var o=new _(h(i,e,r,s),n);return t.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},v(y),y[o]="Generator",y[s]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var e in t)i.push(e);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=L,b.prototype={constructor:b,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(m),!t)for(var i in this)"t"===i.charAt(0)&&e.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function r(e,r){return o.type="throw",o.arg=t,i.next=e,r&&(i.method="next",i.arg=void 0),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s],o=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var h=e.call(n,"catchLoc"),a=e.call(n,"finallyLoc");if(h&&a){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(h){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(t,i){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&e.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var n=s;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=i&&i<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=i,n?(this.method="next",this.next=n.finallyLoc,c):this.complete(o)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),c},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),m(e),c}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var s=r.arg;m(e)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,e){return this.delegate={iterator:L(t),resultName:i,nextLoc:e},"next"===this.method&&(this.arg=void 0),c}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}}));function e(t,i,e,r,s,n,o){try{var h=t[n](o),a=h.value}catch(t){return void e(t)}h.done?i(a):Promise.resolve(a).then(r,s)}var r=function(t){return function(){var i=this,r=arguments;return new Promise((function(s,n){var o=t.apply(i,r);function h(t){e(o,s,n,h,a,"next",t)}function a(t){e(o,s,n,h,a,"throw",t)}h(void 0)}))}},s={ended:!1,won:!1,paused:!1,then:Date.now(),soundtrack:null,gameWon:null,gameLost:null,timer:30,frameCount:0,keys:{}},o=function(){function t(t){this.FillScore=[0,5,10],this.grid=t,this.ctx=t.ctx,this.position=[96,118],this.dx=0,this.dy=0,this.dir=[this.dx,this.dy],this.draw=0,this.drawing=0,this.launch_point=null,this.score=0}var i=t.prototype;return i.add_score=function(t){this.score+=t},i.update=function(){var t,i,e,r=this.position,s=r[0],o=r[1];if(0==(s+o&1)){var h=this.calc_dir();t=h[0],i=h[1],e=h[2],this.drawing?this.grid.cell_empty(s+2*t,o+2*i)||this.grid.cell_wall(s+2*t,o+2*i)&&(s+2*t!==this.launch_point[0]||o+2*i!==this.launch_point[1])?(this.dir=[t,i],s+=t,o+=i,this.grid.set(s,o,this.TRAIL),this.position=[s,o]):this.dir=[0,0]:this.grid.cell_wall(s+t,o+i)?(this.dir=[t,i],s+=t,o+=i,this.position=[s,o]):e&&this.grid.cell_empty(s+t,o+i)&&this.grid.cell_empty(s+2*t,o+2*i)||e&&this.grid.cell_wall(s+2*t,o+2*i)&&this.grid.cell_empty(s+t,o+i)?(this.launch_point=[s,o],this.dir=[t,i],s+=t,o+=i,this.position=[s,o],this.drawing=e,this.grid.set(s,o,this.TRAIL)):this.dir=[0,0]}else{var a=this.dir;if(t=a[0],i=a[1],this.drawing)if(this.grid.cell_wall(s+t,o+i)){s+=t,o+=i,pa=[s-t-i,o-i-t],pb=[s-t+i,o-i+t],this.grid.cell_wall(s-i,o-t)?da=[-i,-t]:da=[t,i],this.grid.cell_wall(s+i,o+t)?db=[+i,+t]:db=[t,i],this.grid.trace([s,o],this.launch_point,[-t,-i],this.TRAIL,this.TRAILTRACE),this.grid.trace([s,o],this.launch_point,da,this.WALL,this.WALLTRACE);var c=Qix.p[0];if(this.grid.seek(pa,c,[10,7]))n=this.grid.fill(pb,[10,7],2),this.add_score(n*this.FillScore[1]),this.grid.percent>75?(this.add_score(Math.round(this.grid.percent-75)*this.FillScore[2]),game.won=!0,game.ended=!0):75===this.grid.percent&&(game.won=!0,game.ended=!0),this.grid.current_filling=n,this.grid.trace([s,o],this.launch_point,da,11,this.WALL),this.grid.trace([s,o],this.launch_point,db,this.WALL,4),this.grid.trace([s,o],this.launch_point,[-t,-i],10,this.WALL);else{var l=this.launch_point,u=l[0],f=l[1];this.grid.set(u,f,11),this.grid.set(s,o,11),n=this.grid.fill(pa,[10,11],2),this.grid.current_filling=n,this.add_score(n*this.FillScore[1]),this.grid.percent>75?(this.add_score(Math.round(this.grid.percent-75)*this.FillScore[2]),game.won=!0,game.ended=!0):75===this.grid.percent&&(game.won=!0,game.ended=!0),this.grid.set(u,f,7),this.grid.set(s,o,7),this.grid.trace([s,o],this.launch_point,da,11,4),this.grid.trace([s,o],this.launch_point,[-t,-i],10,7)}this.drawing=0,this.launch_point=null}else s+=t,o+=i,this.grid.set(s,o,this.TRAIL);else s+=t,o+=i}this.position=[s,o],this.grid.dirty_region(s,o,3)},i.paint=function(){this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.arc(this.grid.offset[0]+3*this.position[0],this.grid.offset[1]+3*this.position[1],5,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.fillStyle="red",this.ctx.fill()},i.calc_dir=function(){var t=0,i=0,e=0;return e=s.keys.shift?1:0,s.keys.left?(t=-1,i=0):s.keys.right?(t=1,i=0):s.keys.up?(t=0,i=-1):s.keys.down?(t=0,i=1):(t=0,i=0),[t,i,e]},t}();o.EMPTY=0,o.TRAIL=5,o.WALL=7,o.OUT=3,o.TRAILTRACE=10,o.WALLTRACE=11;var h={},a=[],c=function(){function t(){}return t.load=function(i){i instanceof Array?i.forEach((function(i){t.loadUrl(i)})):t.loadUrl(i)},t.loadUrl=function(i){if(h[i])return h[i];var e=new Image;e.onload=function(){h[i]=e,t.isReady()&&a.forEach((function(t){t()}))},h[i]=!1,e.src=i},t.get=function(t){return console.log(h,t),h[t]},t.isReady=function(){var t=!0;for(var i in h)h.hasOwnProperty(i)&&!h[i]&&(t=!1);return t},t.onReady=function(t){a.push(t)},t}(),l=function(){function t(t,i,e,r,s,n,o){this.pos=i,this.size=e,this.speed="number"==typeof r?r:0,this.frames=s,this.index=0,this.url=t,this.dir=n||"horizontal",this.once=o}var i=t.prototype;return i.update=function(t){this.index+=this.speed*t},i.getPosition=function(){var t;if(this.speed>0){var i=this.frames.length,e=Math.floor(this.index);if(t=this.frames[e%i],this.once&&e>=i)return void(this.done=!0)}else t=0;var r=this.pos[0],s=this.pos[1];return"vertical"==this.dir?s+=t*this.size[1]:r+=t*this.size[0],{x:r,y:s}},i.render=function(t){var i=this.getPosition();t.drawImage(c.get(this.url),i.x,i.y,this.size[0],this.size[1],0,0,this.size[0],this.size[1])},i.image=function(){var t=this.getPosition(),i=document.createElement("canvas");return i.width=this.size[0],i.height=this.size[1],i.getContext("2d").drawImage(c.get(this.url),t.x,t.y,this.size[0],this.size[1],0,0,this.size[0],this.size[1]),i},t}(),u=function(){function t(t,i,e){this.grid=t,this.sprite=new l("/img/sprites.png",[0,0],[16,16],1,[0,1,2,3,4,5,6,7]),this.ctx=t.ctx,this.dir=e,this.position=i,this.left_turn={"[0,1]":[1,0],"[1,0]":[0,-1],"[0,-1]":[-1,0],"[-1,0]":[0,1]},this.right_turn={"[0,1]":[-1,0],"[1,0]":[0,1],"[0,-1]":[1,0],"[-1,0]":[0,-1]},1===e[0]?this.turn=[this.left_turn,this.right_turn]:this.turn=[this.right_turn,this.left_turn];i[0],i[1]}var i=t.prototype;return i.update=function(){var t=this.position,i=t[0],e=t[1],r=this.dir,n=r[0],h=r[1],a=this.grid;if(a.get(i,e)===o.WALL){if(a.get(i+n,e+h)!==o.WALL){for(var c=!1,l=n,u=h,f=0;!c||f>4;){var d=[this.turn[1]["["+l+","+u+"]"][0],this.turn[1]["["+l+","+u+"]"][1]];l=d[0],u=d[1],a.get(i+l,e+u)===o.WALL&&i+l!==i-n&&e+u!==e-h?(n=l,h=u,c=!0):f++}!c&&f>4&&(n*=-1,h*=-1)}i+=n,e+=h}else if(a.get(i+n,e+h)===o.WALL){i+=n,e+=h;var p=[this.turn[0]["["+n+","+h+"]"][0],this.turn[0]["["+n+","+h+"]"][1]];n=p[0],h=p[1]}else{a.add_crumb(i,e);var g=[];g.push([this.turn[0]["["+n+","+h+"]"][0],this.turn[0]["["+n+","+h+"]"][1]]),g.push([n,h]),g.push([this.turn[1]["["+n+","+h+"]"][0],this.turn[1]["["+n+","+h+"]"][1]]);var y=[Number.MAX_SAFE_INTEGER,[0,0]];g.forEach((function(t){a.cell_traceable(i+t[0],e+t[1])&&a.get_crumbs(i+t[0],e+t[1])<=y[0]&&(y[0]=a.get_crumbs(i+t[0],e+t[1]),y[1]=t)}));var v=y[1];n=v[0],h=v[1],i+=n,e+=h}(i===s.player.position[0]&&e===s.player.position[1]||this.position[0]===s.player.position[0]&&this.position[1]===s.player.position[1])&&(game.ended=!0),this.position=[i,e],a.dirty_region(i,e,4),this.dir=[n,h],this.sprite.update(1)},i.paint=function(){this.ctx.save(),this.ctx.translate(this.grid.offset[0]+3*this.position[0]-6,this.grid.offset[1]+3*this.position[1]-6),this.sprite.render(this.ctx),this.ctx.restore()},t}();var f=function(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i},d=t((function(t){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i})),p=t((function(t){function i(e,r){return t.exports=i=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},i(e,r)}t.exports=i}));var g=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")};var y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}},v=t((function(t){function i(e,r,s){return y()?t.exports=i=Reflect.construct:t.exports=i=function(t,i,e){var r=[null];r.push.apply(r,i);var s=new(Function.bind.apply(t,r));return e&&p(s,e.prototype),s},i.apply(null,arguments)}t.exports=i})),_=function(t){function i(i){var e;return(e=t.call(this)||this).hash=i,e}f(i,t);var e=i.prototype;return e.set=function(i,e){return t.prototype.set.call(this,this.hash(i),e)},e.get=function(i){return t.prototype.get.call(this,this.hash(i))},e.has=function(i){return t.prototype.has.call(this,this.hash(i))},e.delete=function(i){return t.prototype.delete.call(this,this.hash(i))},i}(t((function(t){function i(e){var r="function"==typeof Map?new Map:void 0;return t.exports=i=function(t){if(null===t||!g(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,i)}function i(){return v(t,arguments,d(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),p(i,t)},i(e)}t.exports=i}))(Map)),x=function(){function t(){this.offset=[50,50],this.colors=[[0,0,0],[0,0,180],[160,0,0],[74,54,94],[255,192,203],[255,255,255],[255,255,255],[192,192,192],[255,0,0],[255,0,0],[255,0,0],[255,0,255]],this.enemies=[],this.init(),this.reset(),this.enemies.push(new u(this,[Math.round(this.w/2),2],[1,0])),this.enemies.push(new u(this,[Math.round(this.w/2),2],[-1,0]))}var i=t.prototype;return i.init=function(){this.canvas=document.getElementById("grid"),this.canvas.width=640,this.canvas.height=480,this.ctx=this.canvas.getContext("2d"),this.w=194,this.h=122,this.width=this.w,this.height=this.h,this._grid=[];for(var t=0;t<this.w*(this.h+2);t++)this._grid[t]=0;this.crumbs=[];for(var i=0;i<this.w*(this.h+2);i++)this.crumbs[i]=0;this.percent=0,this.filled_area=0,this.total_area=(this.w-6)*(this.h-6)/4},i.reset=function(){this.dirty=new _(JSON.stringify);for(var t=2;t<this.w;t++)for(var i=2;i<this.h;i++)this.set(t,i,0);for(var e=[this.w,this.h],r=e[0],s=e[1],n=0;n<r;n++)this.set(n,0,o.OUT),this.set(n,1,o.OUT),this.set(n,s-3,o.OUT),this.set(n,s-2,o.OUT),this.set(n,s-1,o.OUT);for(var h=0;h<s;h++)this.set(0,h,o.OUT),this.set(1,h,o.OUT),this.set(r-3,h,o.OUT),this.set(r-2,h,o.OUT),this.set(r-1,h,o.OUT);for(var a=2;a<r-3;a++)this.set(a,2,o.WALL),this.set(a,s-4,o.WALL);for(var c=2;c<s-3;c++)this.set(2,c,o.WALL),this.set(r-4,c,o.WALL)},i.dirty_region=function(t,i,e){for(var r=t-e;r<t+e;r++)for(var s=i-e;s<i+e;s++)r>=0&&r<=this.w&&s>=0&&s<=this.h&&this.dirty.set([r,s],1)},i.clear=function(){this.ctx.fillStyle="#000000",this.ctx.clearRect(this.offset[0],this.offset[1],3*this.w,3*this.h)},i.set=function(t,i,e){this._grid[this.w*i+t]=e,this.dirty.set([t,i],1)},i.get=function(t,i){return this._grid[this.w*i+t]},i.blit=function(t,i,e){},i.paint=function(){var t=this;this.dirty.forEach((function(i,e,r){var s=JSON.parse(e),n=s[0],o=s[1],h=t.get(n,o);t.ctx.fillStyle="rgb("+t.colors[h].join(",")+")",t.offset[1]+3*o+3<=t.offset[1]+3*t.h&&t.ctx.fillRect(t.offset[0]+3*n,t.offset[1]+3*o,3,3)})),this.dirty=new _(JSON.stringify)},i.cell_wall=function(t,i){return this.get(t,i)===o.WALL},i.cell_empty=function(t,i){return this.get(t,i)===o.EMPTY},i.trace=function(t,i,e,r,s){for(var n=t[0],o=t[1],h=e[0],a=e[1],c={"0,0":[0,1],"1,0":[0,1],"0,1":[-1,0],"-1,0":[0,-1],"0,-1":[1,0]},l=!1;!l;)if(n+h===i[0]&&o+a===i[1])l=!0;else if(this.get(n+h,o+a)===r)this.set(n+h,o+a,s),n+=h,o+=a;else{var u=c[[h,a].join(",")];h=u[0],a=u[1]}return[h,a]},i.fill=function(t,i,e,r){var s=this.vmap(i),n=this.seek(t,[3,3],i);r&&(n=!n);for(var o,h=0,a=3;a<this.h-3;a+=2){o=n;for(var c=3;c<this.w-3;c++)s(c,a)?o=!o:o&&(this.set(c,a,e),h+=1&c,s(c,a+1)||this.set(c,a+1,e));s(3,a+1)&&(n=!n)}return this.filled_area+=h,this.percent=100*this.filled_area/this.total_area,h},i.vmap=function(t){for(var i=[],e=0;e<16;e++)i.push(t.includes(e));var r=this;return function(t,e){return void 0===e?i[t]:e>=0?i[r._grid[r.w*e+t]]:0}},i.cell_traceable=function(t,i){return this.vmap([4,7])(t,i)},i.cell_draw=function(t,i){return this.vmap([5])(t,i)},i.seek=function(t,i,e){var r,s,n,o,h=0,a=this.vmap(e);t[0]<=i[0]?(r=t[0],n=t[1],s=i[0],o=i[1]):(s=t[0],o=t[1],r=i[0],n=i[1]);for(var c=r;c<=s;c++)a(c,n)&&h++;if(n<=o)r=s;else{var l=n;r=s,n=o,o=l}for(var u=n;u<=o;u++)a(r,u)&&h++;return h%2==0},i.add_crumb=function(t,i){this.crumbs[this.w*i+t]++},i.get_crumbs=function(t,i){return this.crumbs[this.w*i+t]},i.drawLine=function(t,i){this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(i[0],i[1]),this.ctx.strokeStyle="rgb(255,0,0)",this.ctx.stroke()},i.displayScore=function(){this.ctx.fillStyle="rgb(0,255,0)",this.ctx.clearRect(0,0,this.canvas.width-3,this.offset[1]-3),this.ctx.font="32px Georgia",this.ctx.fillText("Score: "+o.score,80,35),this.ctx.fillText("Area: "+this.percent.toFixed(2)+" / 75%",350,35)},i.displayTimer=function(){this.ctx.clearRect(this.offset[0]-5,this.offset[1]+3*this.height+10,3*this.width+10,40),this.ctx.fillStyle="orange",this.ctx.fillRect(this.offset[0],this.offset[1]+3*this.height+15,game.timer/30*(3*this.width),5),this.ctx.font="20px Georgia",this.ctx.fillText("New enemies in "+game.timer+"s",this.offset[0]+this.width+10,this.offset[1]+3*this.height+45)},t}(),w=function(){function t(){this.ctx=document.getElementById("info").getContext("2d"),this.displayText()}var i=t.prototype;return i.displayText=function(){this.ctx.fillStyle="black",this.ctx.font="bold 32px Georgia",this.ctx.fillText("Objetivo del juego",75,35),this.ctx.font="15px Georgia",this.ctx.fillText("Este juego consiste en rellenar el 75% de la pantalla formando polígonos.",75,70),this.ctx.fillText("Un polígono es completado al conectar la línea con una pared ya existente.",75,90),this.ctx.fillText("Si el enemigo principal, el Qix, choca contigo o cualquier punto de un polígono ",75,110),this.ctx.fillText("sin completar, morirás. Lo mismo ocurrirá si un Sparx te toca.",75,130),this.ctx.font="bold 32px Georgia",this.ctx.fillText("Controles",75,180),this.ctx.font="bold 15px Georgia",this.ctx.fillText("Flechas direccionales:",75,215),this.ctx.font="15px Georgia",this.ctx.fillText("Movimiento del jugador.",250,215),this.ctx.font="bold 15px Georgia",this.ctx.fillText("Shift:",75,235),this.ctx.font="15px Georgia",this.ctx.fillText("Permite comenzar a crear un polígono.",122,235),this.ctx.font="bold 15px Georgia",this.ctx.fillText("'P' y 'p':",75,255),this.ctx.font="15px Georgia",this.ctx.fillText("Pausar o reanudar el juego.",138,255),this.ctx.font="bold 12px Georgia"},i.displayFPS=function(){this.ctx.clearRect(70,450,70,20),this.ctx.fillText("FPS: "+game.fps,75,460)},t}(),m=function(){function t(){var t=this;this.left_turn={"[0,1]":[1,0],"[1,0]":[0,-1],"[0,-1]":[-1,0],"[-1,0]":[0,1]},this.right_turn={"[0,1]":[-1,0],"[1,0]":[0,1],"[0,-1]":[1,0],"[-1,0]":[0,-1]},this.unit_vectors=[[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],this.uvec_index=new _(JSON.stringify);for(var i=0;i<8;i++)this.uvec_index.set(this.unit_vectors[i],i);this.directions=[[1,-2],[2,-1],[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2]],this.dir_index=new _(JSON.stringify);for(var e=0;e<8;e++){this.dir_index.set(this.directions[e],e),this.dir_reflect_x=new _(JSON.stringify),this.directions.forEach((function(i){return t.dir_reflect_x.set(i,[-i[0],i[1]])})),this.dir_reflect_y=new _(JSON.stringify),this.directions.forEach((function(i){return t.dir_reflect_y.set(i,[i[0],-i[1]])})),this.dir_clockwise=new _(JSON.stringify),this.directions.forEach((function(i){return t.dir_clockwise.set(i,t.directions[(t.dir_index.get(i)+1)%8])})),this.dir_cclockwise=new _(JSON.stringify),this.directions.forEach((function(i){return t.dir_cclockwise.set(i,t.directions[(t.dir_index.get(i)+7)%8])})),this.dir_approach=new _(JSON.stringify);for(var r=0;r<8;r++)for(var s=0;s<4;s++)this.dir_approach.set([this.directions[r],this.unit_vectors[(r+s)%8]],this.dir_clockwise.get(this.directions[r])),this.dir_approach.set([this.directions[r],this.unit_vectors[(r+s+4)%8]],this.dir_cclockwise.get(this.directions[r]));this.dir_steps=new _(JSON.stringify);for(var n=void 0,o=void 0,h=void 0,a=void 0,c=0;c<8;c++){var l=this.directions[c];n=l[0],o=l[1],h=this._cmp(n,0),a=this._cmp(o,0),Math.abs(n)>Math.abs(o)?this.dir_steps.set([n,o],[[h,0],[0,a],[h,0]]):this.dir_steps.set([n,o],[[0,a],[h,0],[0,a]])}}this.init()}var i=t.prototype;return i.init=function(){this.p=[[55,55],[57,59]],this.d=[[1,2],[2,1]],this.history=[],this.dhistory=[],this.phase=0},i._cmp=function(t,i){return t>i?1:t<i?-1:0},i.unit_vector=function(t,i){var e=t[0],r=t[1],s=i[0],n=i[1],o=this._cmp(s-e,0),h=this._cmp(n-r,0);return Math.abs(s-e)>2*Math.abs(n-r)?[o,0]:Math.abs(n-r)>2*Math.abs(s-e)?[0,h]:[o,h]},i.clear_line=function(t,i){var e=(i[1]-t[1])/(i[0]-t[0]),r=t[1]-e*t[0];if(t[0]===i[0])for(var s=t[1]<i[1]?[t[1],i[1]]:[i[1],t[1]],n=s[1],o=s[0];o<=n;o++)Grid.dirty_region(t[0]-1,o,1),Grid.dirty_region(t[0]+1,o,1);else{for(var h=t[0]<i[0]?[t[0],i[0]]:[i[0],t[0]],a=h[1],c=h[0]-1;c<=a+1;c++){var l=Math.round(e*c+r);Grid.dirty_region(c,l,1),Grid.dirty_region(c,l+2,1),Grid.dirty_region(c,l-2,1)}for(var u=t[1]<i[1]?[t[1],i[1]]:[i[1],t[1]],f=u[1],d=u[0]-1;d<=f+1;d++){var p=Math.round((d-r)/e);Grid.dirty_region(p,d,1),Grid.dirty_region(p+2,d,1),Grid.dirty_region(p-2,d,1)}}},i.pscan=function(t,i){for(var e=Grid,r=t[0],s=t[1],n=t[0],o=t[1],h=i[0],a=i[1],c=this._cmp(h,n),l=this._cmp(a,o),u=Math.abs(h-n)+1,f=Math.abs(a-o)+1;r!==h||s!==a;)if(Math.abs((h-r)*f)>Math.abs((a-s)*u)){if(!e.cell_empty(r+c,s))return[[r+c,s],[c,0]];r+=2*c}else{if(!e.cell_empty(r,s+l))return[[r,s+l],[0,l]];s+=2*l}return null},i.trace_race=function(t,i,e,r){for(var s=Grid,n=t[0],o=t[1],h=e[0],a=e[1],c=i[0],l=i[1],u=r[0],f=r[1];;){if(!s.cell_wall(n+c,o+l))if(s.cell_wall(n+l,o+c)){var d=[l,c];c=d[0],l=d[1]}else{if(!s.cell_wall(n-l,o-c))throw new Error("trace_race failed 1");var p=[-l,-c];c=p[0],l=p[1]}if(o+=l,(n+=c)===e[0]&&o===e[1])return[i,[-r[0],-r[1]]];if(!s.cell_wall(h+u,a+f))if(s.cell_wall(h+f,a+u)){var g=[f,u];u=g[0],f=g[1]}else{if(!s.cell_wall(h-f,a-u))throw new Error("trace_race failed 2");var y=[-f,-u];u=y[0],f=y[1]}if(a+=f,(h+=u)===t[0]&&a===t[1])return[[-i[0],-i[1]],r]}},i.strategy_random=function(t){Math.random()>.5?this.d[t]=this.dir_clockwise.get(this.d[t]):this.d[t]=this.dir_cclockwise.get(this.d[t])},i.update=function(){for(var t,i,e,r,s,n=Grid,o=[],h=[],a=Grid.offset[0],c=Grid.offset[1],l=0;l<2;l++)if(0===this.phase){this.strategy_random(l);var u=this.p[l];t=u[0],i=u[1];var f=(e=this.dir_steps.get(this.d[l]))[0];r=f[0],s=f[1],n.cell_wall(t+r,i+s)?this.d[l]=0!==r?this.dir_reflect_x.get(this.d[l]):this.dir_reflect_y.get(this.d[l]):(t+=2*r,i+=2*s);var d=e[1];r=d[0],s=d[1],n.cell_wall(t+r,i+s)?this.d[l]=0!==r?this.dir_reflect_x.get(this.d[l]):this.dir_reflect_y.get(this.d[l]):(t+=2*r,i+=2*s),o.push([a+3*(t-r),c+3*(i-s)]),this.p[l]=[t,i],h.push([t,i])}else{var p=this.p[l];t=p[0],i=p[1];var g=(e=this.dir_steps.get(this.d[l]))[2];r=g[0],s=g[1],n.cell_wall(t+r,i+s)?this.d[l]=0!==r?this.dir_reflect_x.get(this.d[l]):this.dir_reflect_y.get(this.d[l]):(t+=2*r,i+=2*s),o.push([a+3*t,c+3*i]),h.push([t,i]),this.p[l]=[t,i]}var y=this.pscan(this.p[0],this.p[1]),v=this.pscan(this.p[1],this.p[0]);if(y){var _=y[0],x=y[1];if(Grid.get(_[0],_[1])===Player.TRAIL||Grid.get(_[0]+x[0],_[1]+x[1])===Player.TRAIL)game.ended=!0;else if(v){var w=v[0],m=v[1];if(Grid.get(w[0],w[1])===Player.TRAIL||Grid.get(w[0]+m[0],w[1]+m[1])===Player.TRAIL)game.ended=!0;else{var b=this.trace_race(_,[this.right_turn["["+x[0]+","+x[1]+"]"][0],this.right_turn["["+x[0]+","+x[1]+"]"][1]],w,[this.right_turn["["+m[0]+","+m[1]+"]"][0],this.right_turn["["+m[0]+","+m[1]+"]"][1]]),L=b[0],T=b[1];this.d[0]=this.dir_approach.get([this.d[0],L]),this.d[1]=this.dir_approach.get([this.d[1],T])}}}this.dhistory.push(h),this.dhistory=this.dhistory.slice(-8),this.history.push(o),this.history=this.history.slice(-8),this.phase^=1},i.draw=function(){for(var i=this.history,e=this.dhistory,r=0;r<i.length;r++)Grid.drawLine(i[r][0],i[r][1]),t.clear_line(e[r][0],e[r][1])},t}();new(function(){function t(){this.info=new w,this.grid=new x,this.qix=new m,this.player=s.player=new o(this.grid),this.loadAssets()}var e,n=t.prototype;return n.loadAssets=function(){var t=this;s.soundtrack=new Howl({src:["/sounds/soundtrack.m4a"],volume:.25}),s.gameWon=new Howl({src:["/sounds/victory.mp3"],volume:.25}),s.gameLost=new Howl({src:["/sounds/fail.mp3"],volume:.25}),c.onReady((function(){t.start()})),c.load(["/img/sprites.png"])},n.measureFPS=function(){var t=Date.now();s.frameCount++,s.delta=t-s.then,s.delta>1e3&&(s.fps=s.frameCount,info.displayFPS(),s.frameCount=0,s.then=t,s.timer--,s.timer<=0&&(this.grid.enemies.push(new u(this.grid,[Math.round(this.grid.w/2),2],[1,0])),this.grid.enemies.push(new u(this.grid,[Math.round(this.grid.w/2),2],[-1,0])),s.timer=30))},n.loop=function(){this.grid.paint(),this.player.update(),this.player.paint(),this.grid.enemies.forEach((function(t){t.update(),t.paint()})),this.qix.update(),this.qix.draw(),this.measureFPS(),this.grid.displayScore(),this.grid.displayTimer(),requestAnimationFrame(this.loop)},n.sleep=function(t){return new Promise((function(i){return setTimeout(i,t)}))},n.start=(e=r(i.mark((function t(){return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.soundtrack.play(),this.onKeydown=this.onKeydown.bind(this),this.onKeyup=this.onKeyup.bind(this),document.addEventListener("keydown",this.onKeydown),document.addEventListener("keyup",this.onKeyup),this.grid.ctx.font="30px Arial",this.grid.ctx.clearRect(this.grid.offset[0]+1.4*this.grid.width,this.grid.offset[1]+1.3*this.grid.height,this.grid.width/5,this.grid.height/3),this.grid.ctx.fillText("3",this.grid.offset[0]+1.5*this.grid.width,this.grid.offset[1]+1.5*this.grid.height),t.next=10,this.sleep(1e3);case 10:return this.grid.ctx.clearRect(this.grid.offset[0]+1.4*this.grid.width,this.grid.offset[1]+1.3*this.grid.height,this.grid.width/5,this.grid.height/3),this.grid.ctx.fillText("2",this.grid.offset[0]+1.5*this.grid.width,this.grid.offset[1]+1.5*this.grid.height),t.next=14,this.sleep(1e3);case 14:return this.grid.ctx.clearRect(this.grid.offset[0]+1.4*this.grid.width,this.grid.offset[1]+1.3*this.grid.height,this.grid.width/5,this.grid.height/3),this.grid.ctx.fillText("1",this.grid.offset[0]+1.5*this.grid.width,this.grid.offset[1]+1.5*this.grid.height),t.next=18,this.sleep(1e3);case 18:this.loop();case 19:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)}),n.toggle=function(){this.paused?(this.paused=!1,this.loop()):this.paused=!0},n.disableAll=function(){var t=this.keys;t.shift=!1,t.up=!1,t.down=!1,t.right=!1,t.left=!1},n.onKeydown=function(t){var i=s.keys;switch(this.disableAll(),i.shift=t.shiftKey,t.keyCode){case 37:t.preventDefault(),i.left=!0;break;case 38:t.preventDefault(),i.up=!0;break;case 39:t.preventDefault(),i.right=!0;break;case 40:t.preventDefault(),i.down=!0;break;case 112:case 80:this.toggle()}},n.onKeyup=function(t){var i=s.keys;switch(t.keyCode){case 37:t.preventDefault(),i.left=!1;break;case 38:t.preventDefault(),i.up=!1;break;case 39:t.preventDefault(),i.right=!1;break;case 40:t.preventDefault(),i.down=!1}},t}())}();
//# sourceMappingURL=main.min.js.map